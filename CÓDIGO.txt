import pandas as pd
import webbrowser
import pyautogui
import os
import time
from datetime import datetime

# Função para verificar aniversário e obter o número do funcionário
def obter_numero_funcionario(caminho_planilha, nome_planilha):
    # Lê a planilha
    df = pd.read_excel(os.path.join(caminho_planilha, nome_planilha))

    # Data de hoje
    hoje = datetime.today().strftime('%Y-%m-%d')

    # Verifica se o aniversário é hoje
    aniversariantes = df[df['Aniversário'].apply(lambda x: x.strftime('%Y-%m-%d') == hoje)]
    
    if not aniversariantes.empty:
        # Pega o número do funcionário
        numero_funcionario = aniversariantes['NUMFUNC'].values[0]
        return numero_funcionario
    else:
        return None

# Caminho e nome da planilha
caminho_planilha = r""  # Atualize com o caminho correto
nome_planilha = "nome_da_planilha.xlsx"  # Atualize com o nome correto da planilha

# Obtém o número do funcionário se o aniversário for hoje
numero_funcionario = obter_numero_funcionario(caminho_planilha, nome_planilha)

if numero_funcionario:
    # URL a ser aberta
    url = ""
    webbrowser.open(url)

    # Aguardar a página carregar
    time.sleep(5)

    # Passo 2: Ir para a coordenada X=466, Y=295 e clicar
    pyautogui.click(466, 295)
    time.sleep(5)

    # Escrever o código do funcionário
    pyautogui.write(str(numero_funcionario))
    time.sleep(5)

    # Passo 3: Ir para a coordenada X=809, Y=475 e clicar
    pyautogui.click(809, 475)
    time.sleep(8)

    # Etapa 4: Capturar a área específica da tela
    # Caminho da pasta onde deseja salvar a imagem
    pasta_destino = r""
    nome_arquivo = "imagem_capturada.jpg"
    caminho_completo = os.path.join(pasta_destino, nome_arquivo)

    # Coordenadas e tamanho da área a ser capturada
    left, top, width, height = 85, 337, 98, 124
    screenshot = pyautogui.screenshot(region=(left, top, width, height))

    # Salva a captura na pasta especificada
    screenshot.save(caminho_completo)

    print(f"Imagem capturada e salva em: {caminho_completo}")
else:
    print("Nenhum aniversariante encontrado para hoje.")