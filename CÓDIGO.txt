import pandas as pd
import tkinter as tk
from tkinter import filedialog, Listbox, MULTIPLE, messagebox

# Função para abrir o arquivo Excel e selecionar a aba
def abrir_arquivo_excel():
    # Abre o diálogo para selecionar o arquivo Excel
    arquivo = filedialog.askopenfilename(
        title="Selecione o arquivo Excel",
        filetypes=[("Arquivo Excel", "*.xlsx"), ("Todos os arquivos", "*.*")]
    )
    if arquivo:
        # Abre o arquivo Excel e lista as abas disponíveis
        excel_data = pd.ExcelFile(arquivo)
        abas = excel_data.sheet_names

        # Cria uma nova janela para seleção de aba
        aba_selecao = tk.Tk()
        aba_selecao.title("Seleção de Aba")

        # Caixa de seleção para as abas
        lista_abas = Listbox(aba_selecao, selectmode=tk.SINGLE)
        for aba in abas:
            lista_abas.insert(tk.END, aba)
        lista_abas.pack()

        def selecionar_aba():
            aba_escolhida = lista_abas.get(lista_abas.curselection())
            aba_selecao.destroy()  # Fecha a janela de seleção de aba
            carregar_dados(arquivo, aba_escolhida)

        botao_selecionar = tk.Button(aba_selecao, text="Selecionar Aba", command=selecionar_aba)
        botao_selecionar.pack()

        aba_selecao.mainloop()
    else:
        messagebox.showerror("Erro", "Nenhum arquivo foi selecionado.")

# Função para carregar os dados da aba selecionada e exibir os cabeçalhos
def carregar_dados(arquivo, aba_escolhida):
    df = pd.read_excel(arquivo, sheet_name=aba_escolhida)
    cabecalhos = df.columns.tolist()

    # Cria uma nova janela para seleção de cabeçalhos
    janela_filtro = tk.Tk()
    janela_filtro.title("Seleção de Cabeçalhos")

    # Lista de seleção múltipla para os cabeçalhos
    lista_cabecalhos = Listbox(janela_filtro, selectmode=MULTIPLE)
    for cabecalho in cabecalhos:
        lista_cabecalhos.insert(tk.END, cabecalho)
    lista_cabecalhos.pack()

    # Função para filtrar os dados com base na seleção
    def aplicar_filtro():
        selecao = [lista_cabecalhos.get(i) for i in lista_cabecalhos.curselection()]
        if selecao:
            df_filtrado = df[selecao]
            messagebox.showinfo("Colunas Filtradas", f"Colunas selecionadas:\n{', '.join(selecao)}")
            print(df_filtrado)  # Você pode manipular o DataFrame como quiser
        else:
            messagebox.showerror("Erro", "Nenhuma coluna foi selecionada.")
        janela_filtro.destroy()

    botao_filtrar = tk.Button(janela_filtro, text="Aplicar Filtro", command=aplicar_filtro)
    botao_filtrar.pack()

    janela_filtro.mainloop()

# Configuração da janela principal
janela = tk.Tk()
janela.withdraw()  # Esconde a janela principal

# Chama a função para abrir o arquivo Excel
abrir_arquivo_excel()

janela.mainloop()