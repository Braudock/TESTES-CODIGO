import pandas as pd

# Caminho para o arquivo Excel
file_path = 'caminho_para_seu_arquivo.xlsx'
sheet_name = 'nome_da_aba'  # Nome da aba que contém os dados
new_sheet_name = 'Contagem'  # Nome da nova aba com as contagens

# Lê a aba especificada do arquivo Excel
df = pd.read_excel(file_path, sheet_name=sheet_name)

# Escolha a coluna que você deseja contar as informações iguais
column_name = 'nome_da_coluna'  # Nome da coluna a ser analisada

# Conta as ocorrências únicas na coluna especificada
ocorrencias = df[column_name].value_counts().reset_index()
ocorrencias.columns = [column_name, 'Quantidade']  # Renomeia as colunas do DataFrame de contagem

# Abre o arquivo Excel para escrita, mantendo o conteúdo existente
with pd.ExcelWriter(file_path, engine='openpyxl', mode='a') as writer:
    # Verifica se a aba onde os dados serão escritos já existe
    try:
        # Tenta carregar a aba existente
        writer.book = load_workbook(file_path)
        # Se a aba existir, remove para evitar duplicação
        if new_sheet_name in writer.book.sheetnames:
            del writer.book[new_sheet_name]
    except FileNotFoundError:
        # Se o arquivo não existir, cria um novo
        pass

    # Escreve o DataFrame de contagem em uma nova aba no arquivo Excel
    ocorrencias.to_excel(writer, sheet_name=new_sheet_name, index=False)

print(f'Contagem de ocorrências adicionada na aba "{new_sheet_name}" do arquivo "{file_path}".')
