import tkinter as tk
from tkinter import ttk
import pandas as pd

# Função para carregar a planilha e exibir os dados
def load_data(sheet_name):
    # Carrega a planilha
    df = pd.read_excel('caminho_para_sua_planilha.xlsx', sheet_name=sheet_name)
    
    # Limpa a Treeview
    for i in tree.get_children():
        tree.delete(i)

    # Configura as colunas na Treeview
    tree["columns"] = list(df.columns)
    tree["show"] = "headings"
    
    for col in tree["columns"]:
        tree.heading(col, text=col, command=lambda _col=col: sort_column(_col, False))
        tree.column(col, width=100)
    
    # Insere os dados na Treeview
    for row in df.itertuples(index=False):
        tree.insert("", "end", values=row)

    # Filtra os dados
    def filter_data():
        query = search_var.get().lower()
        filtered_df = df[df.apply(lambda row: query in row.astype(str).str.lower().to_list(), axis=1)]
        
        # Limpa a Treeview
        for i in tree.get_children():
            tree.delete(i)
        
        # Insere os dados filtrados
        for row in filtered_df.itertuples(index=False):
            tree.insert("", "end", values=row)

    # Configura o botão de filtro
    filter_button.config(command=filter_data)

# Função para ordenar as colunas
def sort_column(col, reverse):
    data = [(tree.set(child, col), child) for child in tree.get_children("")]
    data.sort(reverse=reverse)

    for index, (val, child) in enumerate(data):
        tree.move(child, "", index)

    # Alterna a ordem de classificação
    tree.heading(col, command=lambda: sort_column(col, not reverse))

# Configuração da janela principal
root = tk.Tk()
root.title("Visualizador de Planilha")
root.geometry("800x400")

# Frame para a barra de rolagem
frame = ttk.Frame(root)
frame.pack(fill=tk.BOTH, expand=True)

# Barra de rolagem
scrollbar_y = ttk.Scrollbar(frame, orient=tk.VERTICAL)
scrollbar_x = ttk.Scrollbar(frame, orient=tk.HORIZONTAL)

# Treeview para exibir a planilha
tree = ttk.Treeview(frame, yscrollcommand=scrollbar_y.set, xscrollcommand=scrollbar_x.set)
scrollbar_y.config(command=tree.yview)
scrollbar_x.config(command=tree.xview)

tree.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)
scrollbar_y.pack(side=tk.RIGHT, fill=tk.Y)
scrollbar_x.pack(side=tk.BOTTOM, fill=tk.X)

# Campo de busca e botão de filtro
search_var = tk.StringVar()
search_entry = ttk.Entry(root, textvariable=search_var)
search_entry.pack(side=tk.LEFT, padx=10, pady=10)

filter_button = ttk.Button(root, text="Filtrar")
filter_button.pack(side=tk.LEFT)

# Carrega os dados da primeira aba (ou qualquer aba específica)
load_data(sheet_name='Nome_da_Sua_Aba')

root.mainloop()