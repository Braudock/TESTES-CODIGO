import os
import tkinter as tk
from tkinter import messagebox, ttk
import pythoncom
import win32com.client

def resolve_shortcut(path):
    shell = win32com.client.Dispatch("WScript.Shell")
    shortcut = shell.CreateShortcut(path)
    return shortcut.TargetPath

def open_folder(folder_path):
    try:
        os.startfile(folder_path)
    except Exception as e:
        messagebox.showerror("Erro", f"Não foi possível abrir a pasta: {e}")

def is_directory_or_shortcut(base_path, item):
    item_path = os.path.join(base_path, item)
    if os.path.isdir(item_path):
        return True
    elif item_path.endswith('.lnk'):
        target_path = resolve_shortcut(item_path)
        return os.path.isdir(target_path)
    return False

def create_folder_buttons(frame, base_path):
    items = os.listdir(base_path)
    for item in items:
        if is_directory_or_shortcut(base_path, item):
            item_path = os.path.join(base_path, item)
            if item_path.endswith('.lnk'):
                item_path = resolve_shortcut(item_path)
            button = tk.Button(frame, text=item, command=lambda p=item_path: open_folder(p))
            button.pack(fill=tk.X)

def main():
    base_path = r"C:\caminho\para\pasta"  # Altere para o caminho da sua pasta

    root = tk.Tk()
    root.title("Seletor de Pastas")

    canvas = tk.Canvas(root)
    scrollbar = ttk.Scrollbar(root, orient="vertical", command=canvas.yview)
    scrollable_frame = ttk.Frame(canvas)

    scrollable_frame.bind(
        "<Configure>",
        lambda e: canvas.configure(
            scrollregion=canvas.bbox("all")
        )
    )

    canvas.create_window((0, 0), window=scrollable_frame, anchor="nw")
    canvas.configure(yscrollcommand=scrollbar.set)

    scrollbar.pack(side="right", fill="y")
    canvas.pack(side="left", fill="both", expand=True)

    create_folder_buttons(scrollable_frame, base_path)

    root.mainloop()

if __name__ == "__main__":
    main()
