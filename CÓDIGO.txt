import os
import tkinter as tk
from tkinter import filedialog, messagebox

# Função para buscar arquivos txt que contenham o código especificado
def procurar_arquivos_txt(caminho, codigo):
    arquivos_com_codigo = []
    
    # Caminha pelos diretórios e subdiretórios
    for root, dirs, files in os.walk(caminho):
        for file in files:
            if file.endswith(".txt"):
                file_path = os.path.join(root, file)
                try:
                    # Verifica se o arquivo contém o código desejado
                    with open(file_path, 'r', encoding='utf-8') as f:
                        conteudo = f.read()
                        if codigo in conteudo:
                            arquivos_com_codigo.append((file_path, os.path.getmtime(file_path)))
                except Exception as e:
                    print(f"Erro ao abrir o arquivo {file}: {e}")
    
    # Retorna o último arquivo modificado
    if arquivos_com_codigo:
        return sorted(arquivos_com_codigo, key=lambda x: x[1], reverse=True)[0][0]
    else:
        return None

# Função chamada ao clicar no botão de busca
def buscar_arquivo():
    caminho = r"\\Fswcorp\ceic\DFEPJ\GAGIRE\22 - CARGA\arquivos_processados"  # Caminho já especificado
    codigo = "3411"  # Código especificado
    
    resultado = procurar_arquivos_txt(caminho, codigo)
    if resultado:
        messagebox.showinfo("Arquivo encontrado", f"O último arquivo modificado que contém o código foi encontrado:\n{resultado}")
    else:
        messagebox.showwarning("Aviso", "Nenhum arquivo .txt com o código especificado foi encontrado.")

# Cria a interface gráfica
root = tk.Tk()
root.title("Buscar Arquivos .txt")

# Label para informar o código e caminho
label_info = tk.Label(root, text="Procurando código '3411' em arquivos .txt no caminho:\n\\Fswcorp\\ceic\\DFEPJ\\GAGIRE\\22 - CARGA\\arquivos_processados")
label_info.pack(pady=10)

# Botão para iniciar a busca
btn_buscar = tk.Button(root, text="Buscar Arquivo", command=buscar_arquivo)
btn_buscar.pack(pady=20)

# Inicia a interface gráfica
root.mainloop()