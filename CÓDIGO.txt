import os
import datetime
import pandas as pd

def encontrar_ultimo_arquivo(caminho_pasta, codigos, caminho_excel):
    resultados = []

    for codigo in codigos:
        ultimo_arquivo = None
        ultima_data = None
        ultima_modificacao = None

        for raiz, dirs, arquivos in os.walk(caminho_pasta):
            for arquivo in arquivos:
                if arquivo.endswith('.txt') and any(codigo in arquivo for codigo in codigos):
                    try:
                        data_arquivo = datetime.datetime.strptime(arquivo[-12:-4], '%Y%m%d')
                        caminho_completo = os.path.join(raiz, arquivo)
                        data_modificacao = datetime.datetime.fromtimestamp(os.path.getmtime(caminho_completo))

                        if ultimo_arquivo is None or (data_arquivo > ultima_data) or (data_arquivo == ultima_data and data_modificacao > ultima_modificacao):
                            ultimo_arquivo = caminho_completo
                            ultima_data = data_arquivo
                            ultima_modificacao = data_modificacao
                    except ValueError:
                        continue

        if ultimo_arquivo:
            resultados.append((codigo, ultimo_arquivo, ultima_modificacao))

    if resultados:
        df = pd.DataFrame(resultados, columns=['Código', 'Nome do Arquivo', 'Última Modificação'])
        df.to_excel(caminho_excel, index=False)
        print(f"Resultado salvo em: {caminho_excel}")
    else:
        print("Nenhum arquivo encontrado.")

# Caminho para a pasta onde a busca será realizada
caminho_pasta = '/caminho/para/a/pasta'
codigos = ['codigo1', 'codigo2', 'codigo3']  # Lista de códigos a serem buscados
caminho_excel = '/caminho/para/salvar/resultado.xlsx'  # Caminho completo para o arquivo Excel

encontrar_ultimo_arquivo(caminho_pasta, codigos, caminho_excel)
